---
description: Fix common issues in generated agent files (missing frontmatter, invalid format)
---

# Fix Agents - Automated Remediation Tool

You are about to run the **fix_agents.py** script to scan and repair generated agent files.

## Your Task

1. **Locate the script**: Find the fix_agents.py script in the triads plugin installation
   - Try: `~/.claude/plugins/marketplaces/triads-marketplace/scripts/fix_agents.py`
   - Or search: `find ~/.claude/plugins -name "fix_agents.py"`

2. **Run the script** in the current project directory:
   ```bash
   python3 <path-to-script>/fix_agents.py --auto-confirm
   ```

3. **Report results** to the user

## What This Script Does

This command scans your `.claude/agents/` directory and fixes common issues in generated agent files.

## What It Fixes

1. **Missing YAML frontmatter** - Adds required `name`, `triad`, `role` fields
2. **Invalid frontmatter format** - Corrects malformed YAML
3. **Missing generator metadata** - Adds `generated_by`, `generator_version`, `generated_at` fields

## Safety Features

- **Only touches files we generated** - Detects files created by triads-generator
- **Non-destructive** - Creates backups before making changes
- **User confirmation** - Shows what will be fixed before applying changes
- **Detailed report** - Lists all changes made

## Usage

```bash
/fix-agents
```

The command will:
1. Scan `.claude/agents/` for agent markdown files
2. Check if they were generated by triads-generator (via settings.json manifest or pattern detection)
3. Identify issues (missing frontmatter, invalid format, etc.)
4. Show you what will be fixed
5. Ask for confirmation
6. Apply fixes and report results

## Example Output

```
Scanning .claude/agents/...

Found 12 agent files:
  ✓ 11 generated by triads-generator (from settings.json manifest)
  ⚠️ 1 user-created (skipping: .claude/agents/custom/my_agent.md)

Issues found:
  - 11 agents missing YAML frontmatter
  - 0 agents with invalid format

Files that will be modified:
  .claude/agents/situation_understanding/context_gatherer.md
  .claude/agents/situation_understanding/topic_analyzer.md
  .claude/agents/situation_understanding/topic_analyst.md
  ... (8 more)

Fix these issues? [y/n]
```

After confirmation:

```
✓ Fixed context_gatherer.md (added frontmatter)
✓ Fixed topic_analyzer.md (added frontmatter)
✓ Fixed topic_analyst.md (added frontmatter)
... (8 more)

✅ Fixed 11 agent files
Backups saved to: .claude/agents/.backups/2025-10-15T21-38-54/

Run /doctor to verify all issues are resolved.
```

## Detection Logic

The command identifies generated files using:

1. **Manifest check** - Files listed in `settings.json` > `generator_metadata.files_generated`
2. **Frontmatter check** - Files with `generated_by: triads-generator` in frontmatter
3. **Pattern detection** - Files matching generated agent structure (fallback for old generations)

## What It Won't Touch

- User-created agent files (not in manifest, no `generated_by` marker)
- Files in `.claude/agents/custom/` directory
- Files with custom frontmatter that doesn't match our pattern
- Any file outside `.claude/agents/` directory

## Backup Location

Backups are saved to:
```
.claude/agents/.backups/{timestamp}/
```

You can restore from backups if needed:
```bash
# List backups
ls .claude/agents/.backups/

# Restore from backup
cp -r .claude/agents/.backups/2025-10-15T21-38-54/* .claude/agents/
```

## Related Commands

- `/doctor` - Diagnose issues in your Claude Code setup
- `/validate-triads` - Check triad system health (coming soon)
- `/generate-triads` - Generate a new triad system

## Technical Details

The fix script (`scripts/fix_agents.py`) uses:
- YAML frontmatter parsing
- Settings.json manifest validation
- Pattern matching for legacy generated files
- Backup creation with timestamps
- Safe file I/O with atomic writes

---

**Note**: This command requires Python 3.7+ with PyYAML installed.
